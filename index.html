<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Tejidos al Crochet</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #ffb6c1;
            --secondary-color: #f8e1e5;
            --accent-color: #d4a5a5;
            --text-color: #5a3e36;
            --light-color: #fff9fb;
            --delete-color: #e74c3c;
            --filter-color: #7fb174;
            --drive-color: #4285f4;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .form-container {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .url-input-container {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .url-input-container input {
            flex: 1;
        }
        
        .test-btn {
            background-color: var(--drive-color);
            white-space: nowrap;
        }
        
        .test-btn:hover {
            background-color: #3367d6;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background-color: var(--accent-color);
        }
        
        .export-btn {
            background-color: #7fb174;
        }
        
        .export-btn:hover {
            background-color: #6a9c5f;
        }
        
        .delete-btn {
            background-color: var(--delete-color);
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .delete-btn:hover {
            background-color: #c0392b;
        }
        
        .filter-btn {
            background-color: var(--filter-color);
        }
        
        .filter-btn:hover {
            background-color: #6a9c5f;
        }
        
        .records-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .filters-container {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            display: none;
        }
        
        .filters-container.active {
            display: block;
        }
        
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .tag {
            background-color: var(--secondary-color);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .tag:hover {
            background-color: var(--primary-color);
        }
        
        .tag.active {
            background-color: var(--filter-color);
            color: white;
        }
        
        .records-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }
        
        .record-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .record-card:hover {
            transform: translateY(-5px);
        }
        
        .record-details {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .record-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }
        
        .record-info {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .record-price {
            font-weight: 600;
            color: var(--accent-color);
            font-size: 1.1rem;
            margin-top: auto;
            padding-top: 1rem;
        }
        
        .record-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .record-tag {
            background-color: var(--secondary-color);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        .drive-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background-color: var(--drive-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.9rem;
            margin-top: 1rem;
            transition: background-color 0.3s;
            width: fit-content;
        }
        
        .drive-link:hover {
            background-color: #3367d6;
            text-decoration: none;
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #888;
            grid-column: 1 / -1;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 1rem;
            color: #7fb174;
            font-weight: bold;
        }
        
        .debug-info {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .url-status {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            display: none;
        }
        
        .url-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .url-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .form-container {
                padding: 1.5rem;
            }
            
            .records-container {
                grid-template-columns: 1fr;
            }
            
            .records-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .records-header h2 {
                margin-bottom: 1rem;
            }
            
            .records-header .buttons {
                display: flex;
                flex-wrap: wrap;
            }
            
            .url-input-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Registro de Tejidos al Crochet</h1>
        <p>Organiza y registra tus creaciones de tejido</p>
    </header>
    
    <div class="container">
        <div class="form-container">
            <h2>Agregar Nuevo Tejido</h2>
            <form id="crochet-form">
                <div class="form-group">
                    <label for="title">T√≠tulo / Nombre del amigurumi o tejido *</label>
                    <input type="text" id="title" required>
                </div>
                
                <div class="form-group">
                    <label for="date">Fecha *</label>
                    <input type="date" id="date" required>
                </div>
                
                <div class="form-group">
                    <label for="needle-type">Tipo de aguja *</label>
                    <select id="needle-type" required>
                        <option value="">Selecciona un tipo</option>
                        <option value="2.0 mm">2.0 mm</option>
                        <option value="2.5 mm">2.5 mm</option>
                        <option value="3.0 mm">3.0 mm</option>
                        <option value="3.5 mm">3.5 mm</option>
                        <option value="4.0 mm">4.0 mm</option>
                        <option value="4.5 mm">4.5 mm</option>
                        <option value="5.0 mm">5.0 mm</option>
                        <option value="5.5 mm">5.5 mm</option>
                        <option value="6.0 mm">6.0 mm</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="pattern">Patr√≥n</label>
                    <textarea id="pattern" placeholder="Describe el patr√≥n utilizado..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="source">Donde encontrarlo</label>
                    <input type="text" id="source" placeholder="URL, libro, etc.">
                </div>
                
                <div class="form-group">
                    <label for="measurements">Medidas</label>
                    <input type="text" id="measurements" placeholder="Ej: 15cm x 20cm">
                </div>
                
                <div class="form-group">
                    <label for="accessories">Accesorios</label>
                    <input type="text" id="accessories" placeholder="Ojos, ropa, etc.">
                </div>
                
                <div class="form-group">
                    <label for="weight">Peso</label>
                    <input type="text" id="weight" placeholder="Ej: 150g">
                </div>
                
                <div class="form-group">
                    <label for="price">Precio</label>
                    <input type="number" id="price" min="0" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label for="tags">Etiquetas (separadas por comas)</label>
                    <input type="text" id="tags" placeholder="Ej: amigurumi, animal, regalo, venta">
                </div>
                
                <div class="form-group">
                    <label for="image-url">Enlace de Google Drive *</label>
                    
                    <div class="url-input-container">
                        <input type="url" id="image-url" placeholder="https://drive.google.com/file/d/..." required>
                        <button type="button" class="test-btn" id="test-url">Verificar Enlace</button>
                    </div>
                    <div class="url-status" id="url-status"></div>
                </div>
                
                <button type="submit" id="submit-btn">Guardar Registro</button>
                
                <div class="debug-info" id="debug-info" style="display: none;">
                    <!-- Informaci√≥n de depuraci√≥n -->
                </div>
            </form>
        </div>
        
        <div class="records-header">
            <h2>Registros Guardados</h2>
            <div class="buttons">
                <button class="filter-btn" id="toggle-filters">Filtrar por Etiquetas</button>
                <button class="export-btn" id="export-pdf">Exportar a PDF</button>
            </div>
        </div>
        
        <div class="filters-container" id="filters-container">
            <h3>Filtrar por etiquetas:</h3>
            <div class="filter-tags" id="filter-tags">
                <!-- Las etiquetas se generar√°n autom√°ticamente aqu√≠ -->
            </div>
            <button class="filter-btn" id="clear-filters" style="margin-top: 1rem;">Limpiar Filtros</button>
        </div>
        
        <div class="loading" id="loading">Generando PDF, por favor espere...</div>
        
        <div class="records-container" id="records-container">
            <div class="empty-state" id="empty-state">
                <p>No hay registros guardados a√∫n. ¬°Agrega tu primer tejido!</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Establecer la fecha actual como valor predeterminado
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // Elementos del DOM
            const imageUrlInput = document.getElementById('image-url');
            const testUrlBtn = document.getElementById('test-url');
            const urlStatus = document.getElementById('url-status');
            const form = document.getElementById('crochet-form');
            const submitBtn = document.getElementById('submit-btn');
            const recordsContainer = document.getElementById('records-container');
            const emptyState = document.getElementById('empty-state');
            const exportPdfBtn = document.getElementById('export-pdf');
            const loadingElement = document.getElementById('loading');
            const toggleFiltersBtn = document.getElementById('toggle-filters');
            const filtersContainer = document.getElementById('filters-container');
            const filterTagsContainer = document.getElementById('filter-tags');
            const clearFiltersBtn = document.getElementById('clear-filters');
            const debugInfo = document.getElementById('debug-info');
            
            let activeFilters = [];
            
            // Funci√≥n para verificar que el enlace sea de Google Drive
            function isValidDriveUrl(url) {
                return url.includes('drive.google.com') && url.includes('/file/d/');
            }
            
            // Funci√≥n para probar enlace de Google Drive
            testUrlBtn.addEventListener('click', function() {
                const url = imageUrlInput.value.trim();
                if (!url) {
                    showUrlStatus('Por favor ingresa un enlace', 'error');
                    return;
                }
                
                if (!isValidDriveUrl(url)) {
                    showUrlStatus('‚ùå El enlace no parece ser de Google Drive. Verifica el formato.', 'error');
                    return;
                }
                
                testUrlBtn.disabled = true;
                testUrlBtn.textContent = 'Verificando...';
                
                // Simular verificaci√≥n (sin cargar la imagen)
                setTimeout(() => {
                    showUrlStatus('‚úÖ Enlace v√°lido de Google Drive', 'success');
                    testUrlBtn.disabled = false;
                    testUrlBtn.textContent = 'Verificar Enlace';
                }, 500);
            });
            
            // Funci√≥n para mostrar estado del enlace
            function showUrlStatus(message, type) {
                urlStatus.textContent = message;
                urlStatus.className = 'url-status ' + type;
            }
            
            // Funci√≥n para mostrar informaci√≥n de depuraci√≥n
            function showDebugInfo(message) {
                debugInfo.style.display = 'block';
                debugInfo.innerHTML = `<strong>Depuraci√≥n:</strong> ${message}`;
                console.log(message);
            }
            
            // Funci√≥n para limpiar el formulario correctamente
            function clearForm() {
                form.reset();
                // Restablecer la fecha actual
                document.getElementById('date').value = today;
                // Limpiar el estado del enlace
                urlStatus.className = 'url-status';
                urlStatus.style.display = 'none';
                // Restablecer el bot√≥n de verificaci√≥n
                testUrlBtn.disabled = false;
                testUrlBtn.textContent = 'Verificar Enlace';
                // Limpiar cualquier mensaje de debug
                debugInfo.style.display = 'none';
            }
            
            // Manejar el env√≠o del formulario
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                submitBtn.disabled = true;
                submitBtn.textContent = 'Guardando...';
                
                showDebugInfo('Iniciando proceso de guardado...');
                
                try {
                    // Obtener valores del formulario
                    const title = document.getElementById('title').value;
                    const date = document.getElementById('date').value;
                    const needleType = document.getElementById('needle-type').value;
                    const pattern = document.getElementById('pattern').value;
                    const source = document.getElementById('source').value;
                    const measurements = document.getElementById('measurements').value;
                    const accessories = document.getElementById('accessories').value;
                    const weight = document.getElementById('weight').value;
                    const price = document.getElementById('price').value;
                    const tagsInput = document.getElementById('tags').value;
                    const imageUrl = imageUrlInput.value.trim();
                    
                    showDebugInfo(`Datos capturados: ${title}, ${date}, ${needleType}`);
                    
                    // Validaciones b√°sicas
                    if (!title || !date || !needleType || !imageUrl) {
                        throw new Error('Por favor completa los campos obligatorios (*)');
                    }
                    
                    if (!isValidDriveUrl(imageUrl)) {
                        throw new Error('Por favor ingresa un enlace v√°lido de Google Drive');
                    }
                    
                    // Procesar etiquetas
                    const tags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag !== '');
                    
                    // Crear y guardar registro
                    const record = createRecord(title, date, needleType, pattern, source, 
                                              measurements, accessories, weight, price, 
                                              tags, imageUrl);
                    saveRecord(record);
                    showSuccess();
                    
                } catch (error) {
                    showError(error.message);
                }
            });
            
            // Funci√≥n para crear objeto de registro
            function createRecord(title, date, needleType, pattern, source, measurements, 
                                accessories, weight, price, tags, imageUrl) {
                return {
                    id: Date.now(),
                    title,
                    date,
                    needleType,
                    pattern,
                    source,
                    measurements,
                    accessories,
                    weight,
                    price,
                    tags,
                    imageUrl: imageUrl
                };
            }
            
            // Funci√≥n para guardar registro
            function saveRecord(record) {
                showDebugInfo('Guardando en localStorage...');
                let records = JSON.parse(localStorage.getItem('crochetRecords')) || [];
                records.push(record);
                localStorage.setItem('crochetRecords', JSON.stringify(records));
                showDebugInfo('Registro guardado exitosamente');
            }
            
            // Funci√≥n para mostrar √©xito
            function showSuccess() {
                showDebugInfo('Proceso completado exitosamente');
                alert('¬°Registro guardado correctamente!');
                
                // Actualizar la vista
                displayRecords();
                updateFilterTags();
                
                // Limpiar formulario CORRECTAMENTE
                clearForm();
                
                // Restaurar bot√≥n
                submitBtn.disabled = false;
                submitBtn.textContent = 'Guardar Registro';
            }
            
            // Funci√≥n para mostrar error
            function showError(message) {
                showDebugInfo(`ERROR: ${message}`);
                alert(`Error: ${message}`);
                
                // Restaurar bot√≥n
                submitBtn.disabled = false;
                submitBtn.textContent = 'Guardar Registro';
            }
            
            // Funci√≥n para eliminar registro
            function deleteRecord(id) {
                if (confirm('¬øEst√°s segura de que quieres eliminar este registro?')) {
                    let records = JSON.parse(localStorage.getItem('crochetRecords')) || [];
                    records = records.filter(record => record.id !== id);
                    localStorage.setItem('crochetRecords', JSON.stringify(records));
                    displayRecords();
                    updateFilterTags();
                }
            }
            
            // Funci√≥n para mostrar registros
            function displayRecords() {
                const records = JSON.parse(localStorage.getItem('crochetRecords')) || [];
                let filteredRecords = records;
                
                // Aplicar filtros si hay activos
                if (activeFilters.length > 0) {
                    filteredRecords = records.filter(record => {
                        return activeFilters.some(filter => 
                            record.tags && record.tags.includes(filter)
                        );
                    });
                }
                
                if (filteredRecords.length === 0) {
                    emptyState.style.display = 'block';
                    emptyState.innerHTML = activeFilters.length > 0 
                        ? '<p>No hay registros que coincidan con los filtros seleccionados.</p>'
                        : '<p>No hay registros guardados a√∫n. ¬°Agrega tu primer tejido!</p>';
                    return;
                }
                
                emptyState.style.display = 'none';
                recordsContainer.innerHTML = '';
                
                filteredRecords.forEach((record) => {
                    const recordCard = document.createElement('div');
                    recordCard.className = 'record-card';
                    
                    recordCard.innerHTML = `
                        <div class="record-details">
                            <h3 class="record-title">${record.title}</h3>
                            <p class="record-info"><strong>Fecha:</strong> ${formatDate(record.date)}</p>
                            <p class="record-info"><strong>Aguja:</strong> ${record.needleType}</p>
                            ${record.pattern ? `<p class="record-info"><strong>Patr√≥n:</strong> ${record.pattern}</p>` : ''}
                            ${record.source ? `<p class="record-info"><strong>Fuente:</strong> ${record.source}</p>` : ''}
                            ${record.measurements ? `<p class="record-info"><strong>Medidas:</strong> ${record.measurements}</p>` : ''}
                            ${record.accessories ? `<p class="record-info"><strong>Accesorios:</strong> ${record.accessories}</p>` : ''}
                            ${record.weight ? `<p class="record-info"><strong>Peso:</strong> ${record.weight}</p>` : ''}
                            ${record.price ? `<p class="record-price">Precio: $${parseFloat(record.price).toFixed(2)}</p>` : ''}
                            ${record.tags && record.tags.length > 0 ? `
                                <div class="record-tags">
                                    ${record.tags.map(tag => `<span class="record-tag">${tag}</span>`).join('')}
                                </div>
                            ` : ''}
                            <a href="${record.imageUrl}" target="_blank" class="drive-link">
                                üìÅ Ver imagen en Google Drive
                            </a>
                            <button class="delete-btn" data-id="${record.id}">Eliminar</button>
                        </div>
                    `;
                    
                    recordsContainer.appendChild(recordCard);
                });
                
                // Agregar event listeners a los botones de eliminar
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        deleteRecord(id);
                    });
                });
            }
            
            // Funci√≥n para actualizar las etiquetas de filtro
            function updateFilterTags() {
                const records = JSON.parse(localStorage.getItem('crochetRecords')) || [];
                const allTags = new Set();
                
                // Recopilar todas las etiquetas √∫nicas
                records.forEach(record => {
                    if (record.tags) {
                        record.tags.forEach(tag => allTags.add(tag));
                    }
                });
                
                // Limpiar contenedor de etiquetas
                filterTagsContainer.innerHTML = '';
                
                // Agregar etiquetas al contenedor
                allTags.forEach(tag => {
                    const tagElement = document.createElement('div');
                    tagElement.className = `tag ${activeFilters.includes(tag) ? 'active' : ''}`;
                    tagElement.textContent = tag;
                    tagElement.addEventListener('click', function() {
                        toggleFilter(tag);
                    });
                    filterTagsContainer.appendChild(tagElement);
                });
            }
            
            // Funci√≥n para alternar filtros
            function toggleFilter(tag) {
                if (activeFilters.includes(tag)) {
                    activeFilters = activeFilters.filter(t => t !== tag);
                } else {
                    activeFilters.push(tag);
                }
                displayRecords();
                updateFilterTags();
            }
            
            // Funci√≥n para formatear fecha
            function formatDate(dateString) {
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return new Date(dateString).toLocaleDateString('es-ES', options);
            }
            
            // Event listeners para filtros
            toggleFiltersBtn.addEventListener('click', function() {
                filtersContainer.classList.toggle('active');
            });
            
            clearFiltersBtn.addEventListener('click', function() {
                activeFilters = [];
                displayRecords();
                updateFilterTags();
            });
            
            // Funci√≥n para exportar a PDF (sin im√°genes)
            exportPdfBtn.addEventListener('click', function() {
                loadingElement.style.display = 'block';
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const records = JSON.parse(localStorage.getItem('crochetRecords')) || [];
                
                if (records.length === 0) {
                    doc.setFontSize(12);
                    doc.text('No hay registros guardados.', 20, 30);
                    doc.save('registro_tejidos.pdf');
                    loadingElement.style.display = 'none';
                    return;
                }
                
                // Configuraci√≥n de la p√°gina
                const pageWidth = doc.internal.pageSize.getWidth();
                const margin = 20;
                
                // T√≠tulo del documento
                doc.setFontSize(20);
                doc.setTextColor(40, 40, 40);
                doc.text('Cat√°logo de Tejidos al Crochet', pageWidth / 2, 20, { align: 'center' });
                
                // Fecha de generaci√≥n
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generado el: ${new Date().toLocaleDateString('es-ES')}`, pageWidth - margin, 15, { align: 'right' });
                
                let yPosition = 40;
                
                records.forEach((record, index) => {
                    // Si no es la primera p√°gina y no hay suficiente espacio, agregar nueva p√°gina
                    if (yPosition > 270 && index > 0) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // T√≠tulo del tejido
                    doc.setFontSize(14);
                    doc.setTextColor(90, 62, 54);
                    doc.text(record.title, margin, yPosition);
                    yPosition += 8;
                    
                    // Informaci√≥n del tejido
                    doc.setFontSize(10);
                    doc.setTextColor(80, 80, 80);
                    doc.text(`Fecha: ${formatDate(record.date)}`, margin, yPosition);
                    yPosition += 5;
                    doc.text(`Aguja: ${record.needleType}`, margin, yPosition);
                    yPosition += 5;
                    
                    if (record.pattern) {
                        const patternLines = doc.splitTextToSize(`Patr√≥n: ${record.pattern}`, pageWidth - (2 * margin));
                        doc.text(patternLines, margin, yPosition);
                        yPosition += patternLines.length * 5;
                    }
                    
                    if (record.source) {
                        doc.text(`Fuente: ${record.source}`, margin, yPosition);
                        yPosition += 5;
                    }
                    
                    if (record.measurements) {
                        doc.text(`Medidas: ${record.measurements}`, margin, yPosition);
                        yPosition += 5;
                    }
                    
                    if (record.accessories) {
                        doc.text(`Accesorios: ${record.accessories}`, margin, yPosition);
                        yPosition += 5;
                    }
                    
                    if (record.weight) {
                        doc.text(`Peso: ${record.weight}`, margin, yPosition);
                        yPosition += 5;
                    }
                    
                    if (record.price) {
                        doc.text(`Precio: $${parseFloat(record.price).toFixed(2)}`, margin, yPosition);
                        yPosition += 5;
                    }
                    
                    if (record.tags && record.tags.length > 0) {
                        doc.text(`Etiquetas: ${record.tags.join(', ')}`, margin, yPosition);
                        yPosition += 5;
                    }
                    
                    // Enlace de Google Drive
                    doc.setTextColor(66, 133, 244); // Color azul de Google Drive
                    doc.text(`Enlace de imagen: ${record.imageUrl}`, margin, yPosition);
                    doc.setTextColor(80, 80, 80);
                    yPosition += 8;
                    
                    // L√≠nea separadora
                    doc.setDrawColor(220, 220, 220);
                    doc.line(margin, yPosition, pageWidth - margin, yPosition);
                    yPosition += 15;
                });
                
                // Guardar el PDF
                doc.save(`catalogo_tejidos_${new Date().toISOString().split('T')[0]}.pdf`);
                loadingElement.style.display = 'none';
            });
            
            // Mostrar registros al cargar la p√°gina
            displayRecords();
            updateFilterTags();
            
            showDebugInfo('Aplicaci√≥n cargada correctamente. Usa enlaces de Google Drive para las im√°genes.');
        });
    </script>
</body>
</html>